name: Daily Jogging Reminder

on:
  schedule:
    # Runs at 8 PM UTC every day (adjust to your timezone)
    - cron: '0 20 * * *'
  workflow_dispatch:

permissions:
  contents: read
  issues: write

jobs:
  check-if-jogged:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: Check Today's Push
      id: check
      run: |
        # Get today's date
        TODAY=$(date +%Y-%m-%d)
        
        # Check if there was a push today
        LAST_PUSH=$(git log -1 --format=%cd --date=short)
        
        if [ "$LAST_PUSH" = "$TODAY" ]; then
          echo "pushed_today=true" >> $GITHUB_OUTPUT
          echo "âœ… You pushed today!"
        else
          echo "pushed_today=false" >> $GITHUB_OUTPUT
          echo "âŒ No push today"
        fi
        
        # Get streak info
        STREAK=$(jq -r '.current_streak' streak.json 2>/dev/null || echo "0")
        echo "current_streak=$STREAK" >> $GITHUB_OUTPUT
    
    - name: Create Reminder Issue
      if: steps.check.outputs.pushed_today == 'false'
      uses: actions/github-script@v7
      with:
        script: |
          const today = new Date().toISOString().split('T')[0];
          const streak = '${{ steps.check.outputs.current_streak }}';
          
          // Random motivational messages
          const titles = [
            "ðŸƒâ€â™‚ï¸ Your legs are calling you!",
            "ðŸš¨ Streak Alert: Time to jog!",
            "ðŸ’” Don't break the streak!",
            "ðŸ¦µ Those legs won't move themselves!",
            "â° Tick tock, it's jogging o'clock!",
            "ðŸ”¥ Keep the fire burning!",
            "ðŸ‘Ÿ Your running shoes miss you!",
            "ðŸ’ª 3 years of coding, 30 mins of jogging!"
          ];
          
          const excuses = [
            "But my code has bugs! ðŸ›",
            "Just one more commit... ðŸ’»",
            "It's raining pixels! ðŸŒ§ï¸",
            "My keyboard needs me! âŒ¨ï¸",
            "Stack Overflow is down! ðŸ˜±",
            "The WiFi is too good today! ðŸ“¶",
            "My IDE won't let me go! ðŸ”’",
            "Debugging > Jogging? ðŸ¤”"
          ];
          
          const motivations = [
            "Your heart will thank you! â¤ï¸",
            "Endorphins > Syntax errors! ðŸŽ¯",
            "Fresh air = Fresh ideas! ðŸ’¡",
            "Movement is medicine! ðŸ’Š",
            "Your future self is cheering! ðŸŽ‰",
            "Health is the best feature! âœ¨",
            "Cardio compiles creativity! ðŸ§ ",
            "Run from bugs, literally! ðŸƒ"
          ];
          
          const randomTitle = titles[Math.floor(Math.random() * titles.length)];
          const randomExcuse = excuses[Math.floor(Math.random() * excuses.length)];
          const randomMotivation = motivations[Math.floor(Math.random() * motivations.length)];
          
          const title = `${randomTitle} - ${today}`;
          
          const body = `# ðŸš¨ JOGGING REMINDER ðŸš¨
          
          Hey developer! Your daily jog is waiting! 
          
          ## ðŸ“Š Current Status
          - **Current Streak**: ${streak} days ðŸ”¥
          - **Last Push**: Not today ðŸ˜¢
          - **Status**: Missing in Action ðŸƒâ€â™‚ï¸ðŸ’¨
          
          ## ðŸŽ­ I know what you're thinking...
          > "${randomExcuse}"
          
          ## ðŸ’¡ But remember...
          **${randomMotivation}**
          
          ## ðŸŽ¯ Your Mission
          1. Close this issue
          2. Put on those shoes ðŸ‘Ÿ
          3. Jog for at least 20 minutes ðŸƒ
          4. Push to GitHub when done âœ…
          
          ## ðŸ’ª Motivational Quote
          > "The only bad workout is the one that didn't happen."
          > 
          > Also: "Sitting is the new smoking" ðŸš¬âŒ
          
          ## ðŸ† What's at stake?
          ${streak > 0 ? `Your **${streak} day streak** is on the line! Don't let it go to zero! ðŸ˜±` : 'Time to start building that streak! Day 1 begins now! ðŸŒŸ'}
          
          ---
          
          <details>
          <summary>ðŸ¤– Still procrastinating? Click here...</summary>
          
          ### Fine, here's the deal:
          - Even 15 minutes counts
          - Walking fast is still jogging
          - You can jog while thinking about code
          - Your heart rate monitor will love you
          - This issue will haunt you until you jog
          
          ### Remember why you started:
          **"After 3 years of coding and heart rate issues..."** 
          
          Don't let another day pass! Your health > Your code!
          
          </details>
          
          ---
          
          â° **This issue will auto-close when you push after jogging!**
          
          Now go! Your body is your most important hardware! ðŸ–¥ï¸â¤ï¸`;
          
          // Check if issue already exists for today
          const issues = await github.rest.issues.listForRepo({
            owner: context.repo.owner,
            repo: context.repo.repo,
            state: 'open',
            labels: 'jogging-reminder'
          });
          
          const todayIssue = issues.data.find(issue => issue.title.includes(today));
          
          if (!todayIssue) {
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: title,
              body: body,
              labels: ['jogging-reminder', 'health', 'daily']
            });
          }